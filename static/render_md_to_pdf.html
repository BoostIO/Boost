<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />

    <style media="print">
      pre code {
        /* width: 800px; */
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <div id="markdown-to-pdf-react-div"></div>

    <script type="text/javascript">
      function createLinkElement(hrefPath) {
        let el = document.createElement('link')
        el.rel = 'stylesheet'
        el.type = 'text/css'
        el.href = hrefPath
        return el
      }

      const ipc = window.require('electron').ipcRenderer
      const win = window.require('electron').remote.getCurrentWindow()

      ipc.on('render-markdown-to-pdf', function (
        event,
        markdownHTML,
        cssPaths,
        generalThemeName
      ) {
        // Inject CSS sheets
        cssPaths.forEach((path) => {
          let headEl = document.getElementsByTagName('head')[0]
          let cssLinkEl = createLinkElement(path)
          headEl.appendChild(cssLinkEl)
        })

        // Set main md react content to this page
        let el = document.getElementById('markdown-to-pdf-react-div')
        // Set general theme
        el.classList.add(generalThemeName)
        el.innerHTML = markdownHTML
        if (win !== null) {
          const printOpts = {
            // Needed for codemirorr themes (backgrounds)
            printBackground: true,
            // No margins 1, default margins 0 (some margin set in global style already)
            marginsType: 1, // This could be chosen by user
            pageSize: 'A4', // This could be chosen by user
          }

          // Print to PDF and send the results back to pdf exporter
          win.webContents
            .printToPDF(printOpts)
            .then((data) => {
              ipc.send('pdf-notify-export-data', data)
            })
            .catch((error) => {
              ipc.send('pdf-notify-export-data', data, error)
              console.log('Failed to render PDF:', error)
            })
        } else {
          // Window null, cannot print PDF (maybe notify user with notification)
          console.log('Print failed, try again later!')
        }
      })
    </script>
  </body>
</html>
